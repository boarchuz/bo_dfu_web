<!DOCTYPE html>
<html>
  <head>
    <!-- Origin Trial Token, feature = WebUSB (For Chrome M57+), origin = https://devanlai.github.io, expires = 2017-06-12 -->
    <meta http-equiv="origin-trial" data-feature="WebUSB (For Chrome M57+)" data-expires="2017-06-12" content="AlpizU7PJwl1VtY2tygUFOsZlS4MXx4w5L9OGIifX0777YzN5PiwL+CE/+rk4S9m1D/09oiCXySbys4Ct6EeygUAAABTeyJvcmlnaW4iOiJodHRwczovL2RldmFubGFpLmdpdGh1Yi5pbzo0NDMiLCJmZWF0dXJlIjoiV2ViVVNCMiIsImV4cGlyeSI6MTQ5NzI4MTUwOX0=">
    <title>WebUSB DFU</title>
    <script src="dfu.js"></script>
    <script src="FileSaver.js"></script>
    <script src="dfu-util.js"></script>
    <style>
      p.warning {
        color: red;
      }
      p.error {
        color: red;
        font-weight: bold;
      }
      input:invalid {
        color:red;
      }
    </style>
  </head>
  <body>
    <p>
      <span id="status"></span>
    </p>
    <p>
      <label for="vid">Vendor ID (hex):</label>
      <input list="vendor_ids" type="text" name="vid" id="vid" value="0x1209" maxlength="6" size="8" pattern="0x[A-Fa-f0-9]{1,4}"/>
      <datalist id="vendor_ids">
        <option value="0x1209">dapboot DFU bootloader</option>
        <option value="0x0D28">mbed DAPLink</option>
      </datalist>
    </p>
    <p>
      <button id="connect">Connect</button>
    </p>
    <p>
      <div id="usbInfo" style="white-space: pre"></div>
      <div id="dfuInfo" style="white-space: pre"></div>
    </p>
    <fieldset>
      <legend>Runtime mode</legend>
      <button id="detach" disabled="true">Detach DFU</button>
    </fieldset>
    <fieldset>
      <label for="transferSize">Transfer Size:</label>
      <input type="number" name="transferSize" id="transferSize" value="1024"/>
      <legend>DFU mode</legend>
      <fieldset>
        <legend>Firmware Download (write to USB device)</legend>
        <p>
          <input type="file" id="firmwareFile" name="file" disabled="true"/>
        </p>
        <p>
          <button id="download" disabled="true">Download</button>
        </p>
        <div class="log" id="downloadLog"></div>
      </fieldset>
      <fieldset>
        <legend>Firmware Upload (read from USB device)</legend>
        <p>
          <button id="upload" disabled="true">Upload</button>
        </p>
        <div class="log" id="uploadLog"></div>
      </fieldset>
    </fieldset>
    <h1>About</h1>
    <p>
      This is a proof-of-concept demo of host <a href="http://wiki.openmoko.org/wiki/USB_DFU">USB DFU</a> drivers in Javascript utilizing the <a href="https://wicg.github.io/webusb/">WebUSB</a> draft standard to implement USB firmware updates from the browser.
    </p>
    <h1>Prerequisites</h1>
    <p>In order to run this demo, you will need:</p>
    <ul>
      <li>
        <p>An up-to-date version of Chrome, at least version 52 or newer</p>
        <p>On Chrome 53 and earlier, you must enable the <code>enable-experimental-web-platform-features</code> and <code>enable-webusb</code> flags from the <code>chrome://flags</code> page.</p>
        <p>On Chrome 54 and later, WebUSB is automatically enabled as an <a href="https://github.com/jpchase/OriginTrials/blob/gh-pages/explainer.md">origin trial</a> on this domain.</p>
      </li>
      <li>
        <p>A USB DFU class device with WebUSB support</p>
        <p>See <a href="https://github.com/devanlai/DAPLink/tree/nucleo_webusb">https://github.com/devanlai/DAPLink/tree/nucleo_webusb</a> for a modified version of the <a href="https://developer.mbed.org/handbook/DAPLink">mbed DAPLink firmware</a> for <a href="http://www.st.com/en/evaluation-tools/nucleo-f103rb.html">Nucleo F103RB development boards</a> with WebUSB DFU support.
        <p>Also see <a href="https://github.com/devanlai/dapboot">https://github.com/devanlai/dapboot</a> for a WebUSB DFU bootloader that can be flashed onto <a href="http://wiki.stm32duino.com/index.php?title=Blue_Pill">inexpensive STM32F103 boards</a> for &lt; $10.</p>
      </li>
    <ul>
  </body>
</html>
